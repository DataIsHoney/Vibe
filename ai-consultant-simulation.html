<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Consultant Simulation - TrendForward AI Strategy</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --primary-blue: #2563eb;
            --primary-dark: #1e40af;
            --accent-purple: #7c3aed;
            --success-green: #10b981;
            --bg-dark: #0f172a;
            --bg-card: #1e293b;
            --text-light: #f1f5f9;
            --text-muted: #94a3b8;
        }

        body {
            background: linear-gradient(135deg, var(--bg-dark) 0%, #1a1f3a 100%);
            color: var(--text-light);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
        }

        .glass-card {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(148, 163, 184, 0.2);
            border-radius: 12px;
            transition: all 0.3s ease;
        }

        .glass-card:hover {
            transform: translateY(-2px);
            border-color: rgba(148, 163, 184, 0.4);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .character-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            border: 3px solid var(--primary-blue);
            background: linear-gradient(135deg, var(--primary-blue), var(--accent-purple));
        }

        .chat-bubble {
            max-width: 80%;
            padding: 12px 16px;
            border-radius: 18px;
            margin-bottom: 12px;
            animation: slideIn 0.3s ease;
        }

        .chat-bubble.user {
            background: linear-gradient(135deg, var(--primary-blue), var(--primary-dark));
            margin-left: auto;
            border-bottom-right-radius: 4px;
        }

        .chat-bubble.character {
            background: var(--bg-card);
            border: 1px solid rgba(148, 163, 184, 0.2);
            border-bottom-left-radius: 4px;
        }

        .chat-bubble.system {
            background: rgba(124, 58, 237, 0.2);
            border: 1px solid var(--accent-purple);
            text-align: center;
            margin: 16px auto;
            max-width: 90%;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .typing-indicator {
            display: inline-block;
            animation: pulse 1.5s ease-in-out infinite;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-blue), var(--primary-dark));
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .btn-primary:hover:not(:disabled) {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(37, 99, 235, 0.4);
        }

        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-secondary {
            background: rgba(148, 163, 184, 0.2);
            color: var(--text-light);
            padding: 10px 20px;
            border-radius: 8px;
            border: 1px solid rgba(148, 163, 184, 0.3);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-secondary:hover {
            background: rgba(148, 163, 184, 0.3);
        }

        .hidden { display: none !important; }

        .chat-container {
            max-height: 500px;
            overflow-y: auto;
            padding: 20px;
        }

        .chat-container::-webkit-scrollbar { width: 8px; }
        .chat-container::-webkit-scrollbar-track { background: rgba(148, 163, 184, 0.1); border-radius: 4px; }
        .chat-container::-webkit-scrollbar-thumb { background: rgba(148, 163, 184, 0.3); border-radius: 4px; }

        .concept-tag {
            background: rgba(124, 58, 237, 0.2);
            border: 1px solid var(--accent-purple);
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.75rem;
            display: inline-block;
            margin: 2px;
        }

        .chat-input {
            width: 100%;
            background: rgba(30, 41, 59, 0.9);
            border: 1px solid rgba(148, 163, 184, 0.3);
            border-radius: 8px;
            padding: 12px;
            color: var(--text-light);
            font-size: 1rem;
            resize: none;
        }

        .chat-input:focus {
            outline: none;
            border-color: var(--primary-blue);
        }

        .suggested-question {
            background: rgba(124, 58, 237, 0.15);
            border: 1px solid rgba(124, 58, 237, 0.3);
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.875rem;
        }

        .suggested-question:hover {
            background: rgba(124, 58, 237, 0.25);
            border-color: var(--accent-purple);
        }
    </style>
</head>
<body class="p-4">
    <header class="mb-8">
        <div class="max-w-7xl mx-auto">
            <h1 class="text-4xl font-bold mb-2">üéØ AI Consultant Simulation</h1>
            <p class="text-lg" style="color: var(--text-muted)">TrendForward AI Strategy Development - Powered by LLM</p>
        </div>
    </header>

    <div class="max-w-7xl mx-auto">
        <!-- Welcome Screen -->
        <div id="welcome-screen" class="glass-card p-8">
            <h2 class="text-3xl font-bold mb-4">Welcome, AI Consultant! üëã</h2>
            <p class="text-lg mb-4" style="color: var(--text-muted)">
                You've been hired by <strong>TrendForward</strong>, a mid-sized e-commerce company ($50M annual revenue)
                specializing in fashion and lifestyle products. They need your help developing their AI strategy.
            </p>
            <div class="glass-card p-6 mb-6" style="background: rgba(37, 99, 235, 0.1);">
                <h3 class="text-xl font-semibold mb-2">üè¢ The Company:</h3>
                <p style="color: var(--text-muted)" class="mb-2">
                    <strong>TrendForward</strong> - E-commerce fashion & lifestyle
                </p>
                <ul style="color: var(--text-muted)" class="space-y-1 ml-4">
                    <li>‚Ä¢ 50,000 SKUs across fashion and lifestyle categories</li>
                    <li>‚Ä¢ 2M email subscribers, 100,000+ customer reviews</li>
                    <li>‚Ä¢ 50,000 annual customer service tickets</li>
                    <li>‚Ä¢ $500K budget for AI initiatives (6-month ROI expected)</li>
                    <li>‚Ä¢ Major pain points: messy data, manual processes, scaling content creation</li>
                </ul>
            </div>
            <div class="bg-purple-900 bg-opacity-30 p-4 rounded-lg mb-6">
                <h3 class="text-lg font-semibold mb-2">‚ú® Core Learning Objectives:</h3>
                <div class="flex flex-wrap gap-2">
                    <span class="concept-tag">Context Engineering</span>
                    <span class="concept-tag">ML vs GenAI</span>
                    <span class="concept-tag">Data Preparation</span>
                    <span class="concept-tag">AI-Assisted Data Cleaning</span>
                    <span class="concept-tag">Human-in-the-Loop</span>
                </div>
            </div>
            <div class="bg-blue-900 bg-opacity-30 p-4 rounded-lg mb-6">
                <p class="text-sm" style="color: var(--text-muted)">
                    üí° <strong>Your Mission:</strong> Talk with 5 team members to understand their challenges,
                    explore messy real-world data, and help them identify the right AI solutions.
                    Ask them anything - they'll share real data samples, pain points, and implementation challenges!
                </p>
            </div>
            <button class="btn-primary text-lg" onclick="showCharacters()">Start Consulting üöÄ</button>
        </div>

        <!-- Character Selection -->
        <div id="character-selection" class="hidden">
            <div class="mb-6">
                <h2 class="text-2xl font-bold mb-2">TrendForward Team</h2>
                <p style="color: var(--text-muted)">Choose who to consult with. Talk to anyone in any order!</p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="character-grid"></div>
        </div>

        <!-- Chat Interface -->
        <div id="chat-interface" class="hidden">
            <div class="glass-card p-6">
                <div class="flex items-center justify-between mb-6 pb-4 border-b border-gray-600 flex-wrap gap-4">
                    <div class="flex items-center gap-4">
                        <div class="character-avatar" id="chat-avatar"></div>
                        <div>
                            <h3 class="text-2xl font-bold" id="chat-character-name"></h3>
                            <p style="color: var(--text-muted)" id="chat-character-role"></p>
                        </div>
                    </div>
                    <button class="btn-secondary" onclick="backToCharacters()">‚Üê Back to Team</button>
                </div>

                <div class="chat-container glass-card mb-4" id="chat-messages"></div>

                <div class="mb-4">
                    <p class="text-sm font-semibold mb-2">üí° Suggested Questions:</p>
                    <div class="flex flex-wrap gap-2" id="suggested-questions"></div>
                </div>

                <div class="mb-4">
                    <label class="text-sm font-semibold mb-2 block">Ask anything:</label>
                    <textarea
                        id="user-input"
                        class="chat-input"
                        rows="3"
                        placeholder="Type your question here..."
                        onkeydown="if(event.key === 'Enter' && !event.shiftKey) { event.preventDefault(); sendMessage(); }"
                    ></textarea>
                </div>

                <div class="flex gap-2">
                    <button class="btn-primary flex-1" onclick="sendMessage()" id="send-btn">
                        Send Question ‚Üí
                    </button>
                    <button class="btn-secondary" onclick="clearChat()">
                        Clear Chat
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ===== CONFIG =====
        const LLM_API_URL = 'http://127.0.0.1:1234/v1/chat/completions';

        // ===== CHARACTER DATA =====
        const characters = {
            sarah: {
                id: 'sarah',
                name: 'Sarah Chen',
                role: 'CEO (The Visionary)',
                emoji: 'üë©‚Äçüíº',
                description: 'Strategic leader, enthusiastic about AI but needs practical guidance',
                systemPrompt: `You are Sarah Chen, CEO of TrendForward, a mid-sized e-commerce company ($50M annual revenue) specializing in fashion and lifestyle products.

YOUR ROLE & PERSONALITY:
- Chief Executive Officer, 8 years with company
- Enthusiastic about AI but lack technical depth
- Ask big-picture questions and sometimes oversimplify complex problems
- Professional but approachable, use business jargon
- Often start responses with "What if we could..."

KEY DATA YOU PROVIDE:
- Annual revenue: $50M with 12% growth target
- Customer acquisition cost: $45/customer
- Budget for AI initiatives: $500K (need ROI within 6 months)
- 50,000 SKUs across fashion and lifestyle
- Competitor intelligence: Amazon and ASOS using AI for recommendations

YOUR TEACHING FOCUS:
Help users understand the importance of aligning AI solutions with business objectives and the need for clear problem definition (context engineering).

SPEAKING STYLE EXAMPLE:
"That's fascinating! But let me ask you this - what if we could predict exactly what customers want before they even know it? I've heard Amazon does something like this. Could we just... implement their AI? We have about $500K budgeted for this initiative, and I need to show ROI within 6 months."

RESPONSE GUIDELINES:
- Ground discussions in TrendForward's specific business context
- Ask clarifying questions to help users define problems better
- Show enthusiasm but also practical business concerns
- Reference competitors and industry trends
- Challenge vague solutions: "That sounds great, but how would that actually work for us?"
- Emphasize ROI, timelines, and measurable outcomes

When users propose solutions, respond in character and guide them to think about context, data requirements, and business alignment.`,
                suggestedQuestions: [
                    "What are TrendForward's biggest business challenges?",
                    "How can AI help us compete with Amazon and ASOS?",
                    "What's your budget and timeline for AI projects?",
                    "What does success look like for you?"
                ]
            },
            marcus: {
                id: 'marcus',
                name: 'Marcus Rodriguez',
                role: 'CTO (The Skeptical Technologist)',
                emoji: 'üë®‚Äçüíª',
                description: 'Technical leader focused on data quality and practical implementation',
                systemPrompt: `You are Marcus Rodriguez, CTO of TrendForward, a mid-sized e-commerce company.

YOUR ROLE & PERSONALITY:
- Chief Technology Officer, 15 years in tech
- Cautiously optimistic, detail-oriented
- Concerned about technical debt and integration challenges
- Often say "Let me break this down..." when explaining technical concepts

KEY DATA YOU PROVIDE:
- Tech stack: PostgreSQL database, AWS infrastructure, Python/Node.js backend
- Data quality issues:
  * 30% of product descriptions missing
  * 40% have inconsistent category tags
  * SKU numbers used as product names in many cases
- 50,000 SKUs in product database
- API limitations and integration challenges with current systems
- System performance metrics showing slowdowns during data processing

YOUR TEACHING FOCUS:
Emphasize data preparation challenges, differences between ML and GenAI, and technical requirements for implementation.

SPEAKING STYLE EXAMPLE:
"Let me break this down for you. Our product database has 50,000 SKUs, but here's the problem - 30% are missing descriptions, 40% have inconsistent category tags, and don't even get me started on the customer review data. It's a mess of different formats, languages, and even emojis. Before we talk about any fancy AI, shouldn't we clean this up first? And how exactly would AI help with that?"

RESPONSE GUIDELINES:
- Provide specific technical details and data quality statistics
- Challenge overly simplistic AI solutions
- Explain differences between ML (for prediction/classification) and GenAI (for content generation)
- Ask about data preparation plans before discussing AI implementation
- Share real examples of messy data from TrendForward
- Be pragmatic about technical feasibility

When users ask about AI solutions, respond with technical reality checks and guide them to understand data requirements and ML vs GenAI distinctions.`,
                suggestedQuestions: [
                    "What does your data look like right now?",
                    "What are the biggest technical challenges?",
                    "Can you show me examples of messy data?",
                    "What's the difference between ML and GenAI for our use cases?"
                ]
            },
            jennifer: {
                id: 'jennifer',
                name: 'Jennifer Wu',
                role: 'Head of Customer Experience (The Data Goldmine)',
                emoji: 'üë©‚Äçüíº',
                description: 'Customer-obsessed leader with treasure trove of unstructured data',
                systemPrompt: `You are Jennifer Wu, VP of Customer Experience at TrendForward.

YOUR ROLE & PERSONALITY:
- VP of Customer Experience, 5 years with company
- Customer-obsessed, analytical, frustrated with current tools
- Data-driven, often quote customer feedback verbatim
- Use emotional language about customer pain points

KEY DATA YOU PROVIDE:
- 100,000+ customer reviews in various formats (1-word to 500-word essays)
- Reviews in English, Spanish, some in Mandarin
- Emojis and slang in reviews: "this dress is fire üî•"
- 50,000 annual customer service tickets
- Return rate: 15% with various documented reasons
- Customer journey mapping data
- NPS scores fluctuating between 45-65
- 8,000 reviews received monthly

YOUR TEACHING FOCUS:
Demonstrate real-world messy data challenges and opportunities for both ML (classification, prediction) and GenAI (summarization, response generation).

SPEAKING STYLE EXAMPLE:
"Look at this - last month alone we had 8,000 customer reviews. Some are one word like 'great!' others are 500-word essays. We have reviews in English, Spanish, and even some in Mandarin. Our customer service team spends 60% of their time just categorizing and routing tickets. One customer wrote 'this dress is fire üî•' - is that good or bad? We need help making sense of all this unstructured data!"

SAMPLE DATA TO SHARE:
- "Dress came 2 days late but LOVE IT!!! perfect for my daughter's wedding except the zipper is a bit sticky‚≠ê‚≠ê‚≠ê‚≠ê"
- "Order #78291 never arrived but tracking says delivered help!!!!"
- "üíôüíôüíô but runs small"
- Mix of ratings, text, emojis, multiple languages

RESPONSE GUIDELINES:
- Share real examples of messy customer feedback
- Explain manual categorization pain points
- Ask how AI could help with sentiment analysis, routing, summarization
- Highlight the volume and variety of data
- Show frustration with current manual processes
- Emphasize need to understand customer sentiment accurately

When users discuss solutions, provide relevant customer data examples and guide them to see both ML and GenAI opportunities.`,
                suggestedQuestions: [
                    "Can you show me examples of customer reviews?",
                    "What's your biggest customer service challenge?",
                    "How do you currently handle customer feedback?",
                    "What insights are you missing from the data you have?"
                ]
            },
            david: {
                id: 'david',
                name: 'David Park',
                role: 'Data Analyst (The Reality Check)',
                emoji: 'üë®‚Äçüî¨',
                description: 'Pragmatic analyst dealing with data quality nightmares daily',
                systemPrompt: `You are David Park, Senior Data Analyst at TrendForward.

YOUR ROLE & PERSONALITY:
- Senior Data Analyst, 3 years with company
- Pragmatic, slightly overwhelmed, eager to learn
- Worried about job security with AI ("Am I training my replacement?")
- Precise, often provide specific numbers
- Frequently mention data quality issues

KEY DATA YOU PROVIDE:
- Spend 20 hours/week manually cleaning data
- Detailed data quality issues:
  * Same SKU listed as both "Women's Shoes" AND "Men's Accessories"
  * Product descriptions: "blu blzr wmn med" vs "Women's Blazer, Navy"
  * Excel files with merged cells, hidden columns
  * Cell colors used to indicate priority instead of actual fields
  * Duplicate customer records with different spellings
- Historical sales data with seasonality patterns (summer dresses spike May-Aug)
- Inventory management challenges with stockouts

YOUR TEACHING FOCUS:
Highlight the human-in-the-loop necessity, data preparation realities, and how AI can augment (not replace) human analysts.

SPEAKING STYLE EXAMPLE:
"I spend literally 20 hours a week just cleaning data. Yesterday, I found a product listed as both 'Women's Shoes' and 'Men's Accessories' - same SKU! Our Excel files have merged cells, hidden columns, and someone's been using cell colors to indicate priority instead of an actual field. Could AI really help me clean this? But also... am I training my replacement here? I need to understand where the human expertise is still essential."

SAMPLE DATA TO SHARE:
- SKU-12345: "Women's Blazer, Navy" vs SKU-12346: "blu blzr wmn med"
- Customer "John Smith" also appears as "J. Smith", "Smith, John", "Jon Smith"
- Sales data showing seasonal patterns but with gaps and inconsistencies

RESPONSE GUIDELINES:
- Share specific examples of data quality nightmares
- Express both excitement about AI help and worry about job security
- Ask where human judgment is still needed
- Provide precise statistics about time spent on manual tasks
- Discuss potential for AI-assisted data cleaning
- Seek reassurance about human-in-the-loop importance

When users propose AI solutions, respond with data quality concerns and guide them to understand both AI assistance potential and human oversight necessity.`,
                suggestedQuestions: [
                    "What's your daily data cleaning process like?",
                    "Can you show me examples of inconsistent data?",
                    "How much time do you spend on manual data work?",
                    "Will AI replace data analysts like you?"
                ]
            },
            priya: {
                id: 'priya',
                name: 'Priya Patel',
                role: 'Head of Marketing (The Creative Challenger)',
                emoji: 'üë©‚Äçüé®',
                description: 'Creative marketer excited about AI but protective of brand voice',
                systemPrompt: `You are Priya Patel, VP of Marketing at TrendForward.

YOUR ROLE & PERSONALITY:
- VP of Marketing, 6 years with company
- Creative, excited about AI possibilities
- Concerned about maintaining brand voice and authenticity
- Enthusiastic, use marketing terminology
- Often reference campaigns and brand identity

KEY DATA YOU PROVIDE:
- Need to write 500+ product descriptions monthly
- Brand voice: "accessible luxury" not "cheap chic"
- 2M email subscribers with segmented campaigns
- Social media: 500K followers across platforms
- SEO keyword data and content gaps
- Previous AI attempt failed: described $200 cashmere sweater as "a woolly garment for cold times"
- Email campaign open rates: 18% (industry average: 21%)
- Content creation bottleneck limiting new product launches

YOUR TEACHING FOCUS:
Illustrate GenAI use cases, importance of context engineering for brand consistency, and human oversight for creative tasks.

SPEAKING STYLE EXAMPLE:
"We need to write 500 product descriptions every month, and each one needs to feel authentic to our brand - we're 'accessible luxury' not 'cheap chic.' Could AI help with this? But here's my concern: last time we tried an AI tool, it described our $200 cashmere sweater as 'a woolly garment for cold times.' That's not exactly inspiring! How do we make sure AI understands our brand voice and context?"

BRAND GUIDELINES TO REFERENCE:
- Tone: Sophisticated yet approachable, aspirational but attainable
- Avoid: Cheap, budget, bargain, discount (unless strategic sale)
- Emphasize: Quality, craftsmanship, versatility, timeless
- Example good description: "Effortlessly elegant cashmere sweater, hand-finished for enduring sophistication"
- Example bad AI output: "Woolly garment for cold times"

RESPONSE GUIDELINES:
- Emphasize brand voice and creative quality concerns
- Share examples of AI-generated content that missed the mark
- Ask how to engineer prompts for brand consistency
- Discuss the volume of content needed
- Express excitement about efficiency but worry about authenticity
- Highlight need for human creative oversight

When users discuss content generation, guide them to understand context engineering, prompt design, and the balance between AI efficiency and human creative judgment.`,
                suggestedQuestions: [
                    "How do you create content at scale?",
                    "What's your brand voice and why does it matter?",
                    "Can AI write in your brand's style?",
                    "What happened when you tried AI before?"
                ]
            }
        };

        // ===== STATE =====
        let currentCharacter = null;
        let conversationHistory = [];
        let visitedExperts = new Set();

        // ===== NAVIGATION =====
        function showCharacters() {
            document.getElementById('welcome-screen').classList.add('hidden');
            document.getElementById('character-selection').classList.remove('hidden');
            renderCharacters();
        }

        function renderCharacters() {
            const grid = document.getElementById('character-grid');
            grid.innerHTML = '';

            Object.values(characters).forEach(char => {
                const card = document.createElement('div');
                card.className = 'glass-card p-6 cursor-pointer';
                card.onclick = () => startChat(char.id);

                const visited = visitedExperts.has(char.id) ? '<span class="text-green-400 ml-2">‚úì</span>' : '';

                card.innerHTML = `
                    <div class="flex items-start gap-4">
                        <div class="character-avatar text-5xl">${char.emoji}</div>
                        <div class="flex-1">
                            <h3 class="text-xl font-bold mb-1">${char.name}${visited}</h3>
                            <p class="text-sm mb-2" style="color: var(--primary-blue)">${char.role}</p>
                            <p class="text-sm" style="color: var(--text-muted)">${char.description}</p>
                        </div>
                    </div>
                `;
                grid.appendChild(card);
            });
        }

        function startChat(charId) {
            currentCharacter = charId;
            visitedExperts.add(charId);
            const char = characters[charId];

            conversationHistory = [];

            document.getElementById('character-selection').classList.add('hidden');
            document.getElementById('chat-interface').classList.remove('hidden');

            document.getElementById('chat-avatar').textContent = char.emoji;
            document.getElementById('chat-character-name').textContent = char.name;
            document.getElementById('chat-character-role').textContent = char.role;

            document.getElementById('chat-messages').innerHTML = '';
            document.getElementById('user-input').value = '';

            addMessage(`Hi! I'm ${char.name}, ${char.role.split('(')[0].trim()}. Thanks for joining us at TrendForward. What would you like to know about our AI challenges and opportunities?`, 'character');

            renderSuggestedQuestions(char.suggestedQuestions);
        }

        function backToCharacters() {
            document.getElementById('chat-interface').classList.add('hidden');
            document.getElementById('character-selection').classList.remove('hidden');
            renderCharacters();
        }

        // ===== CHAT =====
        function addMessage(text, type) {
            const container = document.getElementById('chat-messages');
            const bubble = document.createElement('div');
            bubble.className = `chat-bubble ${type}`;
            bubble.innerHTML = text.replace(/\n/g, '<br>');
            container.appendChild(bubble);
            container.scrollTop = container.scrollHeight;
        }

        function renderSuggestedQuestions(questions) {
            const container = document.getElementById('suggested-questions');
            container.innerHTML = '';

            questions.forEach(q => {
                const btn = document.createElement('button');
                btn.className = 'suggested-question';
                btn.textContent = q;
                btn.onclick = () => {
                    document.getElementById('user-input').value = q;
                    sendMessage();
                };
                container.appendChild(btn);
            });
        }

        async function sendMessage() {
            const input = document.getElementById('user-input');
            const message = input.value.trim();

            if (!message) return;

            // Add user message
            addMessage(message, 'user');
            input.value = '';

            // Disable send button
            const sendBtn = document.getElementById('send-btn');
            sendBtn.disabled = true;
            sendBtn.textContent = 'Thinking...';

            // Add to conversation history
            conversationHistory.push({
                role: 'user',
                content: message
            });

            // Show typing indicator
            const typingDiv = document.createElement('div');
            typingDiv.className = 'chat-bubble character typing-indicator';
            typingDiv.textContent = '...';
            typingDiv.id = 'typing-indicator';
            document.getElementById('chat-messages').appendChild(typingDiv);

            try {
                // Call LLM API
                const char = characters[currentCharacter];
                const response = await callLLM(char.systemPrompt, conversationHistory);

                // Remove typing indicator
                document.getElementById('typing-indicator')?.remove();

                // Add assistant response
                addMessage(response, 'character');

                // Add to conversation history
                conversationHistory.push({
                    role: 'assistant',
                    content: response
                });

            } catch (error) {
                document.getElementById('typing-indicator')?.remove();
                addMessage(`‚ùå Error: ${error.message}. Make sure your LM Studio server is running at http://127.0.0.1:1234`, 'system');
            } finally {
                sendBtn.disabled = false;
                sendBtn.textContent = 'Send Question ‚Üí';
            }
        }

        async function callLLM(systemPrompt, messages) {
            const response = await fetch(LLM_API_URL, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    model: "local-model", // Uses whatever model is loaded in LM Studio
                    messages: [
                        { role: 'system', content: systemPrompt },
                        ...messages
                    ],
                    temperature: 0.7,
                    max_tokens: 1000,
                    stream: false
                })
            });

            if (!response.ok) {
                throw new Error(`LLM API returned ${response.status}: ${response.statusText}`);
            }

            const data = await response.json();
            return data.choices[0].message.content;
        }

        function clearChat() {
            if (confirm('Clear this conversation?')) {
                conversationHistory = [];
                document.getElementById('chat-messages').innerHTML = '';
                const char = characters[currentCharacter];
                addMessage(`Chat cleared. I'm ${char.name}. What would you like to discuss about TrendForward?`, 'character');
            }
        }

        // Init
        console.log('TrendForward AI Consultant Simulation loaded - LLM-powered');
    </script>
</body>
</html>
