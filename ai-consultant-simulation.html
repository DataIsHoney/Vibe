<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Consultant Simulation - RetailCo Customer Churn Project</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --primary-blue: #2563eb;
            --primary-dark: #1e40af;
            --accent-purple: #7c3aed;
            --success-green: #10b981;
            --bg-dark: #0f172a;
            --bg-card: #1e293b;
            --text-light: #f1f5f9;
            --text-muted: #94a3b8;
        }

        body {
            background: linear-gradient(135deg, var(--bg-dark) 0%, #1a1f3a 100%);
            color: var(--text-light);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
        }

        .glass-card {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(148, 163, 184, 0.2);
            border-radius: 12px;
            transition: all 0.3s ease;
        }

        .glass-card:hover {
            transform: translateY(-2px);
            border-color: rgba(148, 163, 184, 0.4);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .character-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            border: 3px solid var(--primary-blue);
            background: linear-gradient(135deg, var(--primary-blue), var(--accent-purple));
        }

        .chat-bubble {
            max-width: 75%;
            padding: 12px 16px;
            border-radius: 18px;
            margin-bottom: 12px;
            animation: slideIn 0.3s ease;
        }

        .chat-bubble.user {
            background: linear-gradient(135deg, var(--primary-blue), var(--primary-dark));
            margin-left: auto;
            border-bottom-right-radius: 4px;
        }

        .chat-bubble.character {
            background: var(--bg-card);
            border: 1px solid rgba(148, 163, 184, 0.2);
            border-bottom-left-radius: 4px;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin: 16px 0;
            font-size: 0.875rem;
        }

        .data-table th {
            background: rgba(37, 99, 235, 0.2);
            padding: 8px;
            text-align: left;
            border: 1px solid rgba(148, 163, 184, 0.3);
        }

        .data-table td {
            padding: 8px;
            border: 1px solid rgba(148, 163, 184, 0.2);
        }

        .data-table tr:hover {
            background: rgba(148, 163, 184, 0.1);
        }

        .highlight-red {
            color: #ef4444;
            font-weight: bold;
        }

        .highlight-green {
            color: #10b981;
            font-weight: bold;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .typing-indicator {
            animation: pulse 1.5s ease-in-out infinite;
        }

        .progress-badge {
            background: linear-gradient(135deg, var(--success-green), #059669);
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 600;
        }

        .concept-tag {
            background: rgba(124, 58, 237, 0.2);
            border: 1px solid var(--accent-purple);
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.75rem;
            display: inline-block;
            margin: 2px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-blue), var(--primary-dark));
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .btn-primary:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(37, 99, 235, 0.4);
        }

        .btn-secondary {
            background: rgba(148, 163, 184, 0.2);
            color: var(--text-light);
            padding: 10px 20px;
            border-radius: 8px;
            border: 1px solid rgba(148, 163, 184, 0.3);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-secondary:hover {
            background: rgba(148, 163, 184, 0.3);
            border-color: rgba(148, 163, 184, 0.5);
        }

        .hidden {
            display: none !important;
        }

        .chat-container {
            max-height: 600px;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
        }

        .chat-container::-webkit-scrollbar {
            width: 8px;
        }

        .chat-container::-webkit-scrollbar-track {
            background: rgba(148, 163, 184, 0.1);
            border-radius: 4px;
        }

        .chat-container::-webkit-scrollbar-thumb {
            background: rgba(148, 163, 184, 0.3);
            border-radius: 4px;
        }

        .chat-container::-webkit-scrollbar-thumb:hover {
            background: rgba(148, 163, 184, 0.5);
        }

        .locked {
            opacity: 0.5;
            cursor: not-allowed !important;
            pointer-events: none;
        }

        .story-progress {
            display: flex;
            align-items: center;
            gap: 8px;
            margin: 16px 0;
        }

        .story-step {
            flex: 1;
            height: 4px;
            background: rgba(148, 163, 184, 0.3);
            border-radius: 2px;
            position: relative;
        }

        .story-step.completed {
            background: var(--success-green);
        }

        .story-step.active {
            background: var(--primary-blue);
        }
    </style>
</head>
<body class="p-4">
    <!-- Header -->
    <header class="mb-8">
        <div class="max-w-7xl mx-auto">
            <div class="flex justify-between items-center flex-wrap gap-4">
                <div>
                    <h1 class="text-4xl font-bold mb-2">üéØ AI Consultant Simulation</h1>
                    <p class="text-lg" style="color: var(--text-muted)">RetailCo Customer Churn Prediction Project</p>
                </div>
                <div class="text-right">
                    <div class="progress-badge" id="progress-badge">Step 0/5</div>
                    <button class="btn-secondary mt-2" onclick="toggleDashboard()">üìä Dashboard</button>
                </div>
            </div>
            <div class="story-progress" id="story-progress">
                <!-- Progress steps will be rendered here -->
            </div>
        </div>
    </header>

    <!-- Main Container -->
    <div class="max-w-7xl mx-auto">

        <!-- Welcome Screen -->
        <div id="welcome-screen" class="glass-card p-8 mb-6">
            <h2 class="text-3xl font-bold mb-4">Welcome, AI Consultant! üëã</h2>
            <p class="text-lg mb-4" style="color: var(--text-muted)">
                <strong>RetailCo</strong> is losing customers at an alarming rate. They need your help to build an
                <strong>AI-powered customer churn prediction system</strong> from the ground up.
            </p>
            <div class="glass-card p-6 mb-6" style="background: rgba(239, 68, 68, 0.1); border-color: rgba(239, 68, 68, 0.3);">
                <h3 class="text-xl font-semibold mb-2">üìâ The Problem:</h3>
                <p style="color: var(--text-muted)" class="mb-2">
                    Last quarter, RetailCo lost 23% of their customer base. Customer acquisition costs $150 per customer,
                    but retention interventions cost only $20. If they could predict which customers are likely to churn,
                    they could save millions.
                </p>
            </div>
            <div class="bg-blue-900 bg-opacity-30 p-6 rounded-lg mb-6">
                <h3 class="text-xl font-semibold mb-3">üéì Your Learning Journey:</h3>
                <p style="color: var(--text-muted)" class="mb-4">
                    You'll work with 5 experts to build this AI solution from scratch. This is a <strong>cohesive story</strong> -
                    complete each step in order to progress through the project.
                </p>
                <div class="space-y-2 text-sm" style="color: var(--text-muted)">
                    <div>üìä <strong>Step 1:</strong> Define the AI strategy and choose ML approach</div>
                    <div>üîç <strong>Step 2:</strong> Analyze real customer data and identify patterns</div>
                    <div>ü§ñ <strong>Step 3:</strong> Train models and evaluate performance</div>
                    <div>üí¨ <strong>Step 4:</strong> Design AI agents with prompt engineering</div>
                    <div>üöÄ <strong>Step 5:</strong> Deploy and monitor the system</div>
                </div>
            </div>
            <div class="bg-purple-900 bg-opacity-30 p-4 rounded-lg mb-6">
                <h3 class="text-lg font-semibold mb-2">‚ú® What You'll Learn:</h3>
                <div class="flex flex-wrap gap-2">
                    <span class="concept-tag">Supervised vs Unsupervised ML</span>
                    <span class="concept-tag">Data Analysis</span>
                    <span class="concept-tag">Feature Engineering</span>
                    <span class="concept-tag">Model Evaluation</span>
                    <span class="concept-tag">Prompt Engineering</span>
                    <span class="concept-tag">Agentic Design Patterns</span>
                    <span class="concept-tag">Production Deployment</span>
                </div>
            </div>
            <button class="btn-primary text-lg" onclick="startSimulation()">Start Project üöÄ</button>
        </div>

        <!-- Character Selection Screen -->
        <div id="character-selection" class="hidden">
            <h2 class="text-2xl font-bold mb-4">Project Team</h2>
            <p class="mb-6" style="color: var(--text-muted)">Complete each step in order to progress through the project.</p>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="character-grid">
                <!-- Characters will be rendered here -->
            </div>
        </div>

        <!-- Chat Interface -->
        <div id="chat-interface" class="hidden">
            <div class="glass-card p-6">
                <!-- Character Header -->
                <div class="flex items-center justify-between mb-6 pb-4 border-b border-gray-600 flex-wrap gap-4">
                    <div class="flex items-center gap-4">
                        <div class="character-avatar" id="chat-avatar"></div>
                        <div>
                            <h3 class="text-2xl font-bold" id="chat-character-name"></h3>
                            <p style="color: var(--text-muted)" id="chat-character-role"></p>
                        </div>
                    </div>
                    <button class="btn-secondary" onclick="exitChat()">‚Üê Back to Team</button>
                </div>

                <!-- Chat Messages -->
                <div class="chat-container glass-card mb-4" id="chat-messages">
                    <!-- Messages will appear here -->
                </div>

                <!-- Response Options -->
                <div id="response-options" class="space-y-2">
                    <!-- Response buttons will be rendered here -->
                </div>

                <!-- Learned Concepts -->
                <div class="mt-4 p-4 glass-card" id="learned-concepts-container">
                    <p class="text-sm font-semibold mb-2">üí° Concepts Learned in This Session:</p>
                    <div id="learned-concepts" class="flex flex-wrap gap-2">
                        <!-- Concept tags will appear here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Dashboard -->
        <div id="dashboard" class="hidden glass-card p-6">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold">üìä Project Dashboard</h2>
                <button class="btn-secondary" onclick="toggleDashboard()">Close</button>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="glass-card p-4">
                    <h3 class="text-xl font-semibold mb-4">Project Progress</h3>
                    <div id="characters-progress" class="space-y-2">
                        <!-- Progress will be shown here -->
                    </div>
                </div>

                <div class="glass-card p-4">
                    <h3 class="text-xl font-semibold mb-4">AI Concepts Mastered</h3>
                    <div id="concepts-mastered" class="space-y-2">
                        <!-- Concepts will be shown here -->
                    </div>
                </div>
            </div>

            <div class="mt-6 glass-card p-4">
                <h3 class="text-xl font-semibold mb-4">üìù Project Summary</h3>
                <div id="project-summary" style="color: var(--text-muted)">
                    <p class="mb-3">You're helping RetailCo build a customer churn prediction system. Progress through each step to complete the project.</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ========================================
        // GAME STATE & DATA
        // ========================================

        const STORAGE_KEY = 'ai_consultant_simulation_progress_v2';

        // Character definitions - SEQUENTIAL ORDER
        const characters = {
            sarah: {
                id: 'sarah',
                name: 'Sarah Chen',
                role: 'CEO & Strategy Lead',
                emoji: 'üë©‚Äçüíº',
                description: 'Define the business problem and AI strategy',
                step: 1,
                unlocked: true,
                completed: false,
                concepts: ['Business Problem Framing', 'Supervised Learning', 'Unsupervised Learning', 'ML Types']
            },
            david: {
                id: 'david',
                name: 'David Kim',
                role: 'Data Scientist',
                emoji: 'üë®‚Äçüíª',
                description: 'Analyze customer data and identify churn patterns',
                step: 2,
                unlocked: false,
                completed: false,
                concepts: ['Data Analysis', 'Feature Engineering', 'Pattern Recognition', 'Data Quality']
            },
            marcus: {
                id: 'marcus',
                name: 'Marcus Johnson',
                role: 'ML Engineer',
                emoji: 'üë®‚Äçüîß',
                description: 'Build and evaluate prediction models',
                step: 3,
                unlocked: false,
                completed: false,
                concepts: ['Model Training', 'Evaluation Metrics', 'Precision vs Recall', 'Confusion Matrix']
            },
            elena: {
                id: 'elena',
                name: 'Elena Rodriguez',
                role: 'AI Architect',
                emoji: 'üë©‚Äçüíª',
                description: 'Design AI agents for customer retention',
                step: 4,
                unlocked: false,
                completed: false,
                concepts: ['Prompt Engineering', 'Context Design', 'Agentic Patterns', 'ReAct Pattern']
            },
            jasmine: {
                id: 'jasmine',
                name: 'Jasmine Patel',
                role: 'Product Manager',
                emoji: 'üë©‚Äçüíº',
                description: 'Deploy system and establish monitoring',
                step: 5,
                unlocked: false,
                completed: false,
                concepts: ['Model Deployment', 'A/B Testing', 'Monitoring', 'Human-AI Collaboration']
            }
        };

        // Conversation trees with data analysis
        const conversations = {
            sarah: [
                {
                    id: 'sarah_intro',
                    speaker: 'character',
                    message: "Welcome! I'm Sarah Chen, CEO of RetailCo. We're losing customers at an alarming rate - 23% churn last quarter. Each lost customer costs us $450 in lifetime value, but we spend only $150 to acquire them. Can AI help us predict and prevent churn?",
                    options: [
                        { text: "Yes! Let's start by understanding what type of ML problem this is.", next: 'sarah_ml_types' }
                    ]
                },
                {
                    id: 'sarah_ml_types',
                    speaker: 'character',
                    message: "ML problem? I've heard terms like 'supervised learning' and 'unsupervised learning' thrown around. What do those actually mean, and which one do we need?",
                    options: [
                        { text: "Great question! Let me explain the three main types of machine learning...", next: 'sarah_supervised' }
                    ]
                },
                {
                    id: 'sarah_supervised',
                    speaker: 'character',
                    message: "So supervised learning is like teaching with flashcards - we show the AI examples with known answers (like 'this customer churned' or 'this customer stayed'), and it learns patterns to predict new cases. Unsupervised learning finds hidden patterns without labels, like grouping similar customers. And reinforcement learning learns through trial and error with rewards. For predicting churn, we want supervised learning because we have historical data with known outcomes, right?",
                    concepts: ['Supervised Learning', 'Unsupervised Learning', 'ML Types'],
                    options: [
                        { text: "Exactly! You'll use supervised learning for churn prediction.", next: 'sarah_problem_framing' }
                    ]
                },
                {
                    id: 'sarah_problem_framing',
                    speaker: 'character',
                    message: "Perfect! So we need to frame this correctly. We have data on 10,000 customers from last year - their purchase history, demographics, support tickets, etc. About 2,300 of them churned (stopped buying for 3+ months). We want to predict which of our current 8,500 customers will churn in the next 90 days so we can intervene. Is this the right problem framing?",
                    concepts: ['Business Problem Framing'],
                    options: [
                        { text: "Yes! That's a well-defined classification problem. Let's move forward.", next: 'sarah_complete' }
                    ]
                },
                {
                    id: 'sarah_complete',
                    speaker: 'system',
                    message: '‚úÖ Step 1 Complete! You've defined the business problem and ML approach. The team is ready to analyze the data.',
                    complete: true
                }
            ],
            david: [
                {
                    id: 'david_intro',
                    speaker: 'character',
                    message: "Hi! David Kim, Data Scientist. Sarah briefed me - we're building a churn prediction model. I've pulled a sample of our customer data. Let me show you what we're working with...",
                    options: [
                        { text: "Great! Let's look at the data.", next: 'david_data_preview' }
                    ]
                },
                {
                    id: 'david_data_preview',
                    speaker: 'character',
                    message: `Here's a sample of 10 customers from our dataset:

<table class="data-table">
<tr><th>Customer ID</th><th>Tenure (months)</th><th>Monthly Purchases</th><th>Avg Order Value</th><th>Support Tickets</th><th>Last Purchase (days)</th><th>Churned</th></tr>
<tr><td>C001</td><td>24</td><td>4.2</td><td>$89</td><td>1</td><td>12</td><td class="highlight-green">No</td></tr>
<tr><td>C002</td><td>6</td><td>1.1</td><td>$45</td><td>5</td><td>67</td><td class="highlight-red">Yes</td></tr>
<tr><td>C003</td><td>36</td><td>8.5</td><td>$156</td><td>0</td><td>5</td><td class="highlight-green">No</td></tr>
<tr><td>C004</td><td>3</td><td>0.8</td><td>$32</td><td>3</td><td>92</td><td class="highlight-red">Yes</td></tr>
<tr><td>C005</td><td>18</td><td>3.1</td><td>$72</td><td>2</td><td>8</td><td class="highlight-green">No</td></tr>
<tr><td>C006</td><td>48</td><td>6.7</td><td>$134</td><td>1</td><td>15</td><td class="highlight-green">No</td></tr>
<tr><td>C007</td><td>5</td><td>1.5</td><td>$38</td><td>7</td><td>88</td><td class="highlight-red">Yes</td></tr>
<tr><td>C008</td><td>12</td><td>2.8</td><td>$65</td><td>2</td><td>34</td><td class="highlight-green">No</td></tr>
<tr><td>C009</td><td>2</td><td>0.5</td><td>$28</td><td>4</td><td>105</td><td class="highlight-red">Yes</td></tr>
<tr><td>C010</td><td>30</td><td>5.4</td><td>$112</td><td>1</td><td>7</td><td class="highlight-green">No</td></tr>
</table>

What patterns do you notice between churned and active customers?`,
                    options: [
                        { text: "Churned customers have lower tenure, fewer purchases, more support tickets, and longer time since last purchase.", next: 'david_patterns' }
                    ]
                },
                {
                    id: 'david_patterns',
                    speaker: 'character',
                    message: "Excellent observation! You've just done basic exploratory data analysis. Let me show you the aggregate statistics:\n\n**Churned Customers (avg):** Tenure: 4.2 months | Monthly Purchases: 1.1 | Support Tickets: 4.8 | Days Since Last Purchase: 83\n\n**Active Customers (avg):** Tenure: 28.5 months | Monthly Purchases: 5.2 | Support Tickets: 1.3 | Days Since Last Purchase: 11\n\nThese differences are statistically significant. These variables could be good 'features' for our ML model. But should we use them as-is, or create new features?",
                    concepts: ['Data Analysis', 'Pattern Recognition'],
                    options: [
                        { text: "We should create new features that capture these patterns better.", next: 'david_feature_engineering' }
                    ]
                },
                {
                    id: 'david_feature_engineering',
                    speaker: 'character',
                    message: "Exactly! This is called feature engineering - creating new variables that help the model learn better. For example:\n\n‚Ä¢ **Purchase Velocity Trend:** Is monthly purchase rate increasing or decreasing?\n‚Ä¢ **Engagement Score:** Composite of recency, frequency, monetary value (RFM)\n‚Ä¢ **Support Ticket Ratio:** Support tickets per month of tenure\n‚Ä¢ **High-Value Customer Flag:** Above 75th percentile in lifetime value\n\nThese derived features often predict better than raw data. We also need to handle data quality issues - missing values, outliers, inconsistent formats. This data preparation is 70% of the ML work!",
                    concepts: ['Feature Engineering', 'Data Quality'],
                    options: [
                        { text: "I understand. Clean data + good features = better predictions.", next: 'david_complete' }
                    ]
                },
                {
                    id: 'david_complete',
                    speaker: 'system',
                    message: '‚úÖ Step 2 Complete! You've analyzed the data and engineered features. Ready to build the model!',
                    complete: true
                }
            ],
            marcus: [
                {
                    id: 'marcus_intro',
                    speaker: 'character',
                    message: "Marcus Johnson here, ML Engineer. David prepared great features. Now I need to train a model to predict churn. I'm deciding between three algorithms: Logistic Regression (simple, interpretable), Random Forest (handles complex patterns), and Neural Network (most powerful but black-box). Which should we start with?",
                    options: [
                        { text: "Start with Logistic Regression to establish a baseline, then try more complex models.", next: 'marcus_training' }
                    ]
                },
                {
                    id: 'marcus_training',
                    speaker: 'character',
                    message: "Smart! Always start simple. I split our 10,000 customers into:\n‚Ä¢ **Training set (70%):** 7,000 customers to train the model\n‚Ä¢ **Validation set (15%):** 1,500 to tune hyperparameters\n‚Ä¢ **Test set (15%):** 1,500 to evaluate final performance\n\nI trained all three models. Now comes the critical part - evaluation. We can't just look at 'accuracy' because our data is imbalanced (only 23% churn). A model that predicts 'no churn' for everyone would be 77% accurate but useless! We need better metrics.",
                    concepts: ['Model Training'],
                    options: [
                        { text: "What metrics should we use instead?", next: 'marcus_metrics' }
                    ]
                },
                {
                    id: 'marcus_metrics',
                    speaker: 'character',
                    message: `Great question! Here's the confusion matrix for our Random Forest model on the test set:

<table class="data-table">
<tr><th></th><th>Predicted: Stays</th><th>Predicted: Churns</th></tr>
<tr><th>Actually Stayed (1,155)</th><td class="highlight-green">1,089 (True Negative)</td><td class="highlight-red">66 (False Positive)</td></tr>
<tr><th>Actually Churned (345)</th><td class="highlight-red">52 (False Negative)</td><td class="highlight-green">293 (True Positive)</td></tr>
</table>

From this, we calculate:
‚Ä¢ **Precision:** 293/(293+66) = 81.6% - When we predict churn, we're right 81.6% of the time
‚Ä¢ **Recall:** 293/(293+52) = 84.9% - We catch 84.9% of actual churners
‚Ä¢ **F1-Score:** Harmonic mean of precision and recall = 83.2%

Which is more important for RetailCo - precision or recall?`,
                    concepts: ['Evaluation Metrics', 'Confusion Matrix'],
                    options: [
                        { text: "Recall is more important - we want to catch as many churners as possible, even if we have some false alarms.", next: 'marcus_tradeoffs' }
                    ]
                },
                {
                    id: 'marcus_tradeoffs',
                    speaker: 'character',
                    message: "Exactly! Missing a churner (false negative) costs us $450 in lost lifetime value. A false positive costs us $20 for an unnecessary retention offer. So we optimize for high recall. Our Random Forest achieves 84.9% recall with 81.6% precision - that means:\n\n**Cost Analysis:**\n‚Ä¢ We catch 293/345 churners, saving 293 √ó $450 = $131,850\n‚Ä¢ We unnecessarily target 66 loyal customers, costing 66 √ó $20 = $1,320\n‚Ä¢ **Net benefit:** $130,530 vs doing nothing\n\nThis is how we prove ROI to Sarah!",
                    concepts: ['Precision vs Recall'],
                    options: [
                        { text: "Excellent! The model is ready for production.", next: 'marcus_complete' }
                    ]
                },
                {
                    id: 'marcus_complete',
                    speaker: 'system',
                    message: '‚úÖ Step 3 Complete! Your model is trained and evaluated. Time to design the AI agents!',
                    complete: true
                }
            ],
            elena: [
                {
                    id: 'elena_intro',
                    speaker: 'character',
                    message: "Hey! Elena Rodriguez, AI Architect. The model predicts churn - great! But now we need to ACT on those predictions. I'm designing an AI agent that will automatically reach out to at-risk customers with personalized retention offers. This is where prompt engineering and agentic design come in. Have you heard of these concepts?",
                    options: [
                        { text: "A little, but I'd love to learn more about how they work.", next: 'elena_prompt_engineering' }
                    ]
                },
                {
                    id: 'elena_prompt_engineering',
                    speaker: 'character',
                    message: "Think of prompt engineering as 'programming with words.' Instead of writing code, we write instructions (prompts) that guide AI language models to perform tasks. Here's a bad prompt vs good prompt:\n\n**‚ùå Bad Prompt:**\n'Write a retention email.'\n\n**‚úÖ Good Prompt:**\n'You are a customer success specialist at RetailCo. Write a personalized retention email for a customer who:\n- Hasn't purchased in 67 days (previously bought monthly)\n- Had 5 support tickets (avg customer has 1.2)\n- Valued eco-friendly products\n\nTone: Empathetic and solution-focused\nGoal: Re-engage with 20% discount offer\nLength: 150-200 words'\n\nSee the difference?",
                    concepts: ['Prompt Engineering'],
                    options: [
                        { text: "Yes! The good prompt has clear context, constraints, and goals.", next: 'elena_context_design' }
                    ]
                },
                {
                    id: 'elena_context_design',
                    speaker: 'character',
                    message: "Exactly! This is context engineering - giving the AI the right information to make good decisions. For our retention agent, the context includes:\n\n1. **Customer Profile:** Purchase history, preferences, tenure\n2. **Churn Risk Score:** Model's prediction (0-100)\n3. **Business Rules:** Discount limits, offer restrictions\n4. **Historical Performance:** What worked for similar customers\n\nThe AI uses this context to generate personalized outreach. But what if the first message doesn't work? This is where agentic patterns come in...",
                    concepts: ['Context Design'],
                    options: [
                        { text: "Tell me about agentic design patterns.", next: 'elena_agentic_patterns' }
                    ]
                },
                {
                    id: 'elena_agentic_patterns',
                    speaker: 'character',
                    message: "Agentic design means the AI can take multi-step actions and adapt based on results. Here's the **ReAct Pattern** (Reasoning + Acting) I'm using:\n\n**Agent Workflow:**\n1. **Observe:** Customer C002 has 87% churn risk\n2. **Reason:** 'Customer had 5 support tickets - likely frustrated with product quality'\n3. **Act:** Send empathy email offering product upgrade\n4. **Observe:** Email opened but no response after 3 days\n5. **Reason:** 'Customer engaged but needs stronger incentive'\n6. **Act:** Escalate to human rep with discount authority\n7. **Observe:** Customer accepted offer and purchased\n8. **Learn:** Update successful pattern for future similar cases\n\nThe agent doesn't just send one message - it runs a multi-step campaign with adaptive logic!",
                    concepts: ['Agentic Patterns', 'ReAct Pattern'],
                    options: [
                        { text: "This is powerful! The AI can run entire workflows autonomously.", next: 'elena_complete' }
                    ]
                },
                {
                    id: 'elena_complete',
                    speaker: 'system',
                    message: '‚úÖ Step 4 Complete! Your AI agent is designed with advanced prompt engineering and agentic patterns!',
                    complete: true
                }
            ],
            jasmine: [
                {
                    id: 'jasmine_intro',
                    speaker: 'character',
                    message: "Hi! Jasmine Patel, Product Manager. We're ready to deploy! But launching an AI system in production is very different from testing in a lab. We need to think about monitoring, A/B testing, and human oversight. Let's talk deployment strategy.",
                    options: [
                        { text: "What's the deployment plan?", next: 'jasmine_deployment' }
                    ]
                },
                {
                    id: 'jasmine_deployment',
                    speaker: 'character',
                    message: "We're doing a **staged rollout:**\n\n**Week 1 (Pilot):** Deploy to 500 customers (5% of at-risk population)\n- AI agent handles automated outreach\n- Human team monitors all interactions\n- Goal: Validate system works without breaking things\n\n**Week 2-4 (A/B Test):**\n- **Group A (Control):** 2,000 customers, no intervention\n- **Group B (AI Agent):** 2,000 customers, automated retention\n- **Group C (Human+AI):** 2,000 customers, AI recommends, humans execute\n\nWe'll measure churn rate, cost per save, and customer satisfaction across groups.",
                    concepts: ['Model Deployment', 'A/B Testing'],
                    options: [
                        { text: "Smart! We'll have data to prove which approach works best.", next: 'jasmine_monitoring' }
                    ]
                },
                {
                    id: 'jasmine_monitoring',
                    speaker: 'character',
                    message: "Exactly! But deployment isn't 'set and forget.' We need continuous monitoring:\n\n**Real-Time Dashboards:**\n‚Ä¢ Model prediction distribution (is it still seeing 23% churn risk?)\n‚Ä¢ Precision/Recall tracking (are metrics degrading?)\n‚Ä¢ Agent performance (email open rates, conversion rates)\n‚Ä¢ Customer feedback sentiment\n\n**Alert Triggers:**\n‚Ä¢ Model accuracy drops below 80% ‚Üí Retrain needed\n‚Ä¢ Agent generates inappropriate content ‚Üí Human review\n‚Ä¢ Unexpected data patterns ‚Üí Investigate data drift\n\nML models degrade over time as customer behavior changes. We retrain monthly with fresh data.",
                    concepts: ['Monitoring'],
                    options: [
                        { text: "What about human oversight? Should humans review every AI decision?", next: 'jasmine_human_ai' }
                    ]
                },
                {
                    id: 'jasmine_human_ai',
                    speaker: 'character',
                    message: "Great question! We use a **tiered oversight model:**\n\n**ü§ñ Fully Automated (60% of cases):**\n- Low-risk predictions (churn score 60-75%)\n- Standard retention offers\n- AI handles end-to-end\n\n**üë§+ü§ñ Human-in-the-Loop (30%):**\n- High-value customers (>$5000 lifetime value)\n- Complex situations (multiple support escalations)\n- AI recommends, human approves\n\n**üë§ Human-Only (10%):**\n- VIP customers\n- Sensitive situations (complaints, refunds)\n- Legal/compliance edge cases\n\nThis balances automation efficiency with human judgment for critical decisions. We also have a 'feedback loop' - humans can override AI decisions, and those overrides become training data to improve the model!",
                    concepts: ['Human-AI Collaboration'],
                    options: [
                        { text: "Perfect! This is a production-ready system with proper governance.", next: 'jasmine_complete' }
                    ]
                },
                {
                    id: 'jasmine_complete',
                    speaker: 'system',
                    message: '‚úÖ Step 5 Complete! The churn prediction system is deployed and monitored. PROJECT COMPLETE! üéâ',
                    complete: true
                }
            ]
        };

        // Game state
        let gameState = {
            currentStep: 0,
            charactersCompleted: [],
            conceptsLearned: new Set(),
            currentCharacter: null,
            conversationHistory: []
        };

        // ========================================
        // INITIALIZATION
        // ========================================

        function initializeGame() {
            loadProgress();
            updateProgressBadge();
            renderStoryProgress();
        }

        function loadProgress() {
            const saved = localStorage.getItem(STORAGE_KEY);
            if (saved) {
                try {
                    const data = JSON.parse(saved);
                    gameState.currentStep = data.currentStep || 0;
                    gameState.charactersCompleted = data.charactersCompleted || [];
                    gameState.conceptsLearned = new Set(data.conceptsLearned || []);

                    // Update character unlock/completion status
                    Object.values(characters).forEach(char => {
                        if (gameState.charactersCompleted.includes(char.id)) {
                            char.completed = true;
                        }
                        char.unlocked = char.step <= gameState.currentStep + 1;
                    });
                } catch (e) {
                    console.error('Error loading progress:', e);
                }
            }
        }

        function saveProgress() {
            const data = {
                currentStep: gameState.currentStep,
                charactersCompleted: gameState.charactersCompleted,
                conceptsLearned: Array.from(gameState.conceptsLearned)
            };
            localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
        }

        // ========================================
        // NAVIGATION
        // ========================================

        function startSimulation() {
            document.getElementById('welcome-screen').classList.add('hidden');
            document.getElementById('character-selection').classList.remove('hidden');
            renderCharacters();
        }

        function renderCharacters() {
            const grid = document.getElementById('character-grid');
            grid.innerHTML = '';

            // Sort characters by step order
            const sortedChars = Object.values(characters).sort((a, b) => a.step - b.step);

            sortedChars.forEach(char => {
                const card = document.createElement('div');
                const isLocked = !char.unlocked;
                card.className = `glass-card p-6 ${isLocked ? 'locked' : 'cursor-pointer'}`;

                if (!isLocked) {
                    card.onclick = () => startConversation(char.id);
                }

                const completedBadge = char.completed
                    ? '<span class="progress-badge ml-2">‚úì Completed</span>'
                    : '';

                const lockedBadge = isLocked
                    ? '<span class="ml-2 text-yellow-400">üîí Locked</span>'
                    : '';

                card.innerHTML = `
                    <div class="flex items-start gap-4">
                        <div class="character-avatar text-5xl">
                            ${char.emoji}
                        </div>
                        <div class="flex-1">
                            <div class="flex items-center mb-1">
                                <span class="text-sm font-bold" style="color: var(--primary-blue)">Step ${char.step}</span>
                            </div>
                            <h3 class="text-xl font-bold mb-1">${char.name} ${completedBadge}${lockedBadge}</h3>
                            <p class="text-sm" style="color: var(--text-muted)">${char.role}</p>
                            <p class="mt-2 text-sm" style="color: var(--text-muted)">${char.description}</p>
                        </div>
                    </div>
                `;

                grid.appendChild(card);
            });
        }

        function renderStoryProgress() {
            const container = document.getElementById('story-progress');
            container.innerHTML = '';

            for (let i = 1; i <= 5; i++) {
                const step = document.createElement('div');
                step.className = 'story-step';

                if (i <= gameState.currentStep) {
                    step.classList.add('completed');
                } else if (i === gameState.currentStep + 1) {
                    step.classList.add('active');
                }

                container.appendChild(step);
            }
        }

        function startConversation(characterId) {
            const char = characters[characterId];

            if (!char.unlocked) {
                alert('Complete previous steps first!');
                return;
            }

            gameState.currentCharacter = characterId;
            gameState.conversationHistory = [];

            // Update UI
            document.getElementById('character-selection').classList.add('hidden');
            document.getElementById('chat-interface').classList.remove('hidden');
            document.getElementById('chat-avatar').textContent = char.emoji;
            document.getElementById('chat-character-name').textContent = char.name;
            document.getElementById('chat-character-role').textContent = char.role;

            // Clear previous chat
            document.getElementById('chat-messages').innerHTML = '';
            document.getElementById('learned-concepts').innerHTML = '';

            // Start conversation - FIX: Use characterId + '_intro'
            displayNextMessage(characterId + '_intro');
        }

        function exitChat() {
            document.getElementById('chat-interface').classList.add('hidden');
            document.getElementById('character-selection').classList.remove('hidden');
            renderCharacters();
        }

        // ========================================
        // CONVERSATION SYSTEM
        // ========================================

        function displayNextMessage(nodeId) {
            const conversation = conversations[gameState.currentCharacter];
            const node = conversation.find(n => n.id === nodeId);

            if (!node) {
                console.error('Conversation node not found:', nodeId);
                return;
            }

            // Add concepts learned
            if (node.concepts) {
                node.concepts.forEach(concept => {
                    gameState.conceptsLearned.add(concept);
                    addConceptTag(concept);
                });
            }

            // Display message
            if (node.speaker === 'character' || node.speaker === 'system') {
                addChatMessage(node.message, node.speaker);
            }

            // Check if conversation is complete
            if (node.complete) {
                completeCharacter();
                return;
            }

            // Display response options
            if (node.options && node.options.length > 0) {
                displayResponseOptions(node.options);
            }
        }

        function addChatMessage(message, speaker) {
            const container = document.getElementById('chat-messages');
            const bubble = document.createElement('div');

            if (speaker === 'system') {
                bubble.className = 'text-center p-4 my-4';
                bubble.innerHTML = `<div class="progress-badge inline-block text-lg">${message}</div>`;
            } else {
                bubble.className = `chat-bubble ${speaker}`;
                bubble.innerHTML = message; // Use innerHTML to support HTML tables
            }

            container.appendChild(bubble);
            container.scrollTop = container.scrollHeight;
        }

        function displayResponseOptions(options) {
            const container = document.getElementById('response-options');
            container.innerHTML = '';

            options.forEach(option => {
                const button = document.createElement('button');
                button.className = 'btn-secondary w-full text-left p-4';
                button.textContent = option.text;
                button.onclick = () => handleResponse(option);
                container.appendChild(button);
            });
        }

        function handleResponse(option) {
            // Add user's response to chat
            addChatMessage(option.text, 'user');

            // Clear options
            document.getElementById('response-options').innerHTML = '';

            // Show typing indicator briefly
            const typingIndicator = document.createElement('div');
            typingIndicator.className = 'chat-bubble character typing-indicator';
            typingIndicator.textContent = '...';
            typingIndicator.id = 'typing';
            document.getElementById('chat-messages').appendChild(typingIndicator);

            // Display next message after brief delay
            setTimeout(() => {
                document.getElementById('typing')?.remove();
                displayNextMessage(option.next);
            }, 1000);
        }

        function addConceptTag(concept) {
            const container = document.getElementById('learned-concepts');

            // Check if already displayed
            if (container.querySelector(`[data-concept="${concept}"]`)) {
                return;
            }

            const tag = document.createElement('span');
            tag.className = 'concept-tag';
            tag.textContent = concept;
            tag.setAttribute('data-concept', concept);
            container.appendChild(tag);
        }

        function completeCharacter() {
            const charId = gameState.currentCharacter;
            const char = characters[charId];

            if (!gameState.charactersCompleted.includes(charId)) {
                gameState.charactersCompleted.push(charId);
                char.completed = true;
                gameState.currentStep = char.step;

                // Unlock next character
                Object.values(characters).forEach(c => {
                    if (c.step === gameState.currentStep + 1) {
                        c.unlocked = true;
                    }
                });
            }

            saveProgress();
            updateProgressBadge();
            renderStoryProgress();

            // Show completion button
            setTimeout(() => {
                const container = document.getElementById('response-options');
                const allComplete = gameState.currentStep === 5;

                container.innerHTML = `
                    <button class="btn-primary w-full text-lg" onclick="exitChat()">
                        ${allComplete ? 'üéâ View Final Dashboard' : '‚Üí Continue to Next Step'}
                    </button>
                `;
            }, 2000);
        }

        // ========================================
        // DASHBOARD
        // ========================================

        function toggleDashboard() {
            const dashboard = document.getElementById('dashboard');
            const isDashboardVisible = !dashboard.classList.contains('hidden');

            // Hide all screens
            document.getElementById('welcome-screen').classList.add('hidden');
            document.getElementById('character-selection').classList.add('hidden');
            document.getElementById('chat-interface').classList.add('hidden');
            dashboard.classList.add('hidden');

            if (!isDashboardVisible) {
                // Show dashboard
                dashboard.classList.remove('hidden');
                renderDashboard();
            } else {
                // Return to character selection
                document.getElementById('character-selection').classList.remove('hidden');
                renderCharacters();
            }
        }

        function renderDashboard() {
            // Character progress
            const charProgress = document.getElementById('characters-progress');
            charProgress.innerHTML = '';

            const sortedChars = Object.values(characters).sort((a, b) => a.step - b.step);

            sortedChars.forEach(char => {
                const item = document.createElement('div');
                item.className = 'flex items-center justify-between p-3 glass-card';
                let status = '<span class="text-gray-400">‚è∏ Locked</span>';

                if (char.completed) {
                    status = '<span class="progress-badge">‚úì Completed</span>';
                } else if (char.unlocked) {
                    status = '<span class="text-yellow-400">‚è≥ In Progress</span>';
                }

                item.innerHTML = `
                    <span>${char.emoji} Step ${char.step}: ${char.name}</span>
                    ${status}
                `;
                charProgress.appendChild(item);
            });

            // Concepts mastered
            const conceptsList = document.getElementById('concepts-mastered');
            conceptsList.innerHTML = '';

            if (gameState.conceptsLearned.size === 0) {
                conceptsList.innerHTML = '<p style="color: var(--text-muted)">No concepts learned yet. Start the project!</p>';
            } else {
                gameState.conceptsLearned.forEach(concept => {
                    const item = document.createElement('div');
                    item.className = 'concept-tag';
                    item.textContent = `‚úì ${concept}`;
                    conceptsList.appendChild(item);
                });
            }

            // Project summary
            const summary = document.getElementById('project-summary');
            const progress = (gameState.currentStep / 5 * 100).toFixed(0);

            summary.innerHTML = `
                <p class="mb-3"><strong>Project Progress: ${progress}% Complete</strong></p>
                <p class="mb-3">You've completed ${gameState.currentStep} of 5 steps in building RetailCo's AI-powered customer churn prediction system.</p>
                ${gameState.currentStep === 5 ? `
                    <div class="glass-card p-4 mt-4" style="background: rgba(16, 185, 129, 0.1); border-color: rgba(16, 185, 129, 0.3);">
                        <p class="font-bold mb-2">üéâ PROJECT COMPLETE!</p>
                        <p>You've successfully built an end-to-end AI solution:</p>
                        <ul class="list-disc list-inside mt-2 space-y-1">
                            <li>Defined the ML problem as supervised classification</li>
                            <li>Analyzed customer data and engineered predictive features</li>
                            <li>Trained and evaluated models with proper metrics</li>
                            <li>Designed AI agents with prompt engineering and agentic patterns</li>
                            <li>Deployed with monitoring, A/B testing, and human oversight</li>
                        </ul>
                        <p class="mt-3"><strong>Expected Impact:</strong> Reduce churn by 15%, saving RetailCo $130,530 in the first quarter!</p>
                    </div>
                ` : ''}
            `;
        }

        function updateProgressBadge() {
            document.getElementById('progress-badge').textContent = `Step ${gameState.currentStep}/5`;
        }

        // ========================================
        // INITIALIZE ON LOAD
        // ========================================

        window.addEventListener('DOMContentLoaded', initializeGame);
    </script>
</body>
</html>
